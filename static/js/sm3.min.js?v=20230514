var sm3Utils=(function(){function leftPad(input,num){if(input.length>=num)return input;return(new Array(num-input.length+1)).join('0')+input};function binary2hex(binary){var binaryLength=8;var hex='';for(var i=0;i<binary.length/binaryLength;i++){hex+=leftPad(parseInt(binary.substr(i*binaryLength,binaryLength),2).toString(16),2)}return hex};function hex2binary(hex){var hexLength=2;var binary='';for(var i=0;i<hex.length/hexLength;i++){binary+=leftPad(parseInt(hex.substr(i*hexLength,hexLength),16).toString(2),8)}return binary};function str2binary(str){var binary='';for(var i=0,len=str.length;i<len;i++){var point=str.codePointAt(i);if(point<=0x007f){binary+=leftPad(point.toString(2),8)}else if(point<=0x07ff){binary+=leftPad((0xc0|(point>>>6)).toString(2),8);binary+=leftPad((0x80|(point&0x3f)).toString(2),8)}else if(point<=0xD7FF||(point>=0xE000&&point<=0xFFFF)){binary+=leftPad((0xe0|(point>>>12)).toString(2),8);binary+=leftPad((0x80|((point>>>6)&0x3f)).toString(2),8);binary+=leftPad((0x80|(point&0x3f)).toString(2),8)}else if(point>=0x010000&&point<=0x10FFFF){i++;binary+=leftPad((0xf0|((point>>>18)&0x1c)).toString(2),8);binary+=leftPad((0x80|((point>>>12)&0x3f)).toString(2),8);binary+=leftPad((0x80|((point>>>6)&0x3f)).toString(2),8);binary+=leftPad((0x80|(point&0x3f)).toString(2),8)}else{binary+=leftPad(point.toString(2),8);throw new Error('input is not supported');}}return binary}function array2binary(arr){return arr.reduce((temp,item)=>temp+leftPad(item.toString(2),8),'')};function rol(str,n){return str.substring(n%str.length)+str.substr(0,n%str.length)};function binaryCal(x,y,method){var a=x||'';var b=y||'';var result=[];var prevResult;for(var i=a.length-1;i>=0;i--){prevResult=method(a[i],b[i],prevResult);result[i]=prevResult[0]}return result.join('')}function xor(x,y){return binaryCal(x,y,(a,b)=>[(a===b?'0':'1')])};function and(x,y){return binaryCal(x,y,(a,b)=>[(a==='1'&&b==='1'?'1':'0')])};function or(x,y){return binaryCal(x,y,(a,b)=>[(a==='1'||b==='1'?'1':'0')])};function add(x,y){var result=binaryCal(x,y,(a,b,prevResult)=>{var carry=prevResult?prevResult[1]:'0'||'0';if(a!==b)return[carry==='0'?'1':'0',carry];return[carry,a]});return result};function not(x){return binaryCal(x,undefined,a=>[a==='1'?'0':'1'])};function calMulti(method){return(...arr)=>arr.reduce((prev,curr)=>method(prev,curr))};function P0(X){return calMulti(xor)(X,rol(X,9),rol(X,17))};function P1(X){return calMulti(xor)(X,rol(X,15),rol(X,23))};function FF(X,Y,Z,j){return j>=0&&j<=15?calMulti(xor)(X,Y,Z):calMulti(or)(and(X,Y),and(X,Z),and(Y,Z))};function GG(X,Y,Z,j){return j>=0&&j<=15?calMulti(xor)(X,Y,Z):or(and(X,Y),and(not(X),Z))};function T(j){return j>=0&&j<=15?hex2binary('79cc4519'):hex2binary('7a879d8a')};function CF(V,Bi){var wordLength=32;var W=[];var M=[];for(var i=0;i<16;i++){W.push(Bi.substr(i*wordLength,wordLength))};for(var j=16;j<68;j++){W.push(calMulti(xor)(P1(calMulti(xor)(W[j-16],W[j-9],rol(W[j-3],15))),rol(W[j-13],7),W[j-6]))};for(var j=0;j<64;j++){M.push(xor(W[j],W[j+4]))};var wordRegister=[];for(var j=0;j<8;j++){wordRegister.push(V.substr(j*wordLength,wordLength))}var A=wordRegister[0];var B=wordRegister[1];var C=wordRegister[2];var D=wordRegister[3];var E=wordRegister[4];var F=wordRegister[5];var G=wordRegister[6];var H=wordRegister[7];var SS1;var SS2;var TT1;var TT2;for(var j=0;j<64;j++){SS1=rol(calMulti(add)(rol(A,12),E,rol(T(j),j)),7);SS2=xor(SS1,rol(A,12));TT1=calMulti(add)(FF(A,B,C,j),D,SS2,M[j]);TT2=calMulti(add)(GG(E,F,G,j),H,SS1,W[j]);D=C;C=rol(B,9);B=A;A=TT1;H=G;G=rol(F,19);F=E;E=P0(TT2)}return xor([A,B,C,D,E,F,G,H].join(''),V)};var sm3main=function(str){var binary=typeof str==='string'?str2binary(str):array2binary(str);var len=binary.length;var k=len%512;k=k>=448?512-(k%448)-1:448-k-1;var m=`${binary}1${leftPad('',k)}${leftPad(len.toString(2),64)}`.toString();var n=(len+k+65)/512;var V=hex2binary('7380166f4914b2b9172442d7da8a0600a96f30bc163138aae38dee4db0fb0e4e');for(var i=0;i<=n-1;i++){var B=m.substr(512*i,512);V=CF(V,B)}return binary2hex(V)};return{gmsm3:sm3main}})();window.sm3=sm3Utils.gmsm3;window.SM3=sm3Utils.gmsm3;